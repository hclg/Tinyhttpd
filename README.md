# Tinyhttpd

* 主要执行流程图：

![img](https://images2017.cnblogs.com/blog/422590/201711/422590-20171110141226856-793077190.png)

* startup(u_short *port) //先开始启动web服务器的套接字，开始监听对应的端口连接。

  > 返回创建好的套接字

  * 创建套接字

    * 地址，套接字文件描述符

  * 初始化地址信息

    * IP版本、端口、IP地址

      > Server一般而言将IP地址赋值为INADDR_ANY（该宏值为0），即无论发送到系统中的哪个IP地址（当服务器有多张网卡时会有多个IP地址）的请求都采用该socket来处理，而无需指定固定IP。

  * 分配地址信息（使套接字关联一个相应的地址和端口号 失败返回-1

  * 判断端口号是否为0

    * 如果为0就是动态分配端口号，就要取出分配的端口号
      * getsockname得到套接字绑定的信息，和长度
      * 取出端口，ntohs将网络号转回字符串

  * 准备接受套接字上的连接

    >  在请求拒绝之前N个请求将排队连接

* 循环等待接收套接字的连接 

  > 连接到达时开启一个新的套接字与它通信

  * 要连接的地址和地址长度

* 创建线程去处理请求

  * 传入accept_request()请求处理和要处理的套接字

* 请求处理